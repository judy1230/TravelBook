<link href="//maxcdn.bootstrapcdn.com/bootstrap/4.1.1/css/bootstrap.min.css" rel="stylesheet" id="bootstrap-css">
<script src="//maxcdn.bootstrapcdn.com/bootstrap/4.1.1/js/bootstrap.min.js"></script>
<script src="//cdnjs.cloudflare.com/ajax/libs/jquery/3.2.1/jquery.min.js"></script>


<div class="container mt-5 mb-5 p-5 row">

	<div class="col-6 ml-5">
		<h4>Today's Tour</h4>
		<ul class="moveable timeline" id="items-list">

			<li>
				<a>{{origin}} {{startHourInit}} : {{startMinInit}}</a>
				<span class="float-right"> {{../date}}</span>
			</li>
			{{#each array1}}
			<li>
				<div class="card mb-3" style="max-width: 300px;">
					<div class="row no-gutters">
						<div class="col-md-6">
							<img src="{{this.image}}" class="card-img" height="160px" width="160px"alt="">
						</div>
						<div class="col-md-6">
							<div class="card-body">
								<h6 class="card-title" href="#">{{this.destination}} {{this.end}}</h6>
								<h7 class="card-content" style="color:purple">stay: {{this.stayTime}} mins</h7>
								<p class="card-text" style="font-size: 14px;"><span><i class="fas fa-car" style="color:deepskyblue"></i></span> {{this.duration}}</p>
							</div>
						</div>
					</div>
				</div>
			</li>
			{{/each}}
		</ul>
	</div>
	<!-- 地圖放置處 -->

	<div class="col-4 ml-5 mt-5 text-center sticky-top">
		<div class=" sticky-top" id="map">
			<iframe width="450" height="300" frameborder="0" style="border:0"
				src="https://www.google.com/maps/embed/v1/directions?key={{API_KEY}}&origin={{origin}}&destination={{destination}}">>
			</iframe>
		</div>
	</div>
</div>

<script>

	let items = document.querySelectorAll('#items-list > li')

	items.forEach(item => {
		$(item).prop('draggable', true)
		item.addEventListener('dragstart', dragStart)
		item.addEventListener('drop', dropped)
		item.addEventListener('dragenter', cancelDefault)
		item.addEventListener('dragover', cancelDefault)
	})

	function dragStart(e) {
		var index = $(e.target).index()
		e.dataTransfer.setData('text/plain', index)
	}

	function dropped(e) {
		cancelDefault(e)

		// get new and old index
		let oldIndex = e.dataTransfer.getData('text/plain')
		let target = $(e.target)
		let newIndex = target.index()

		// remove dropped items at old place
		let dropped = $(this).parent().children().eq(oldIndex).remove()

		// insert the dropped items at new place
		if (newIndex < oldIndex) {
			target.before(dropped)

		} else {
			target.after(dropped)
		}
	}

	function cancelDefault(e) {
		e.preventDefault()
		e.stopPropagation()
		return false
	}
</script>

<style>
	ul.timeline {
		list-style-type: none;
		position: relative;
	}

	ul.timeline:before {
		content: ' ';
		background: #d4d9df;
		display: inline-block;
		position: absolute;
		left: 29px;
		width: 2px;
		height: 100%;
		z-index: 200;
	}

	ul.timeline>li {
		margin: 20px 0;
		padding-left: 20px;
	}

	ul.timeline>li:before {
		content: ' ';
		background: white;
		display: inline-block;
		position: absolute;
		border-radius: 50%;
		border: 3px solid #22c0e8;
		left: 20px;
		width: 20px;
		height: 20px;
		z-index: 400;
	}

	[draggable="true"] {
		user-select: none;
		-moz-user-select: none;
		-webkit-user-select: none;
		-ms-user-select: none;
	}



	ul.moveable {
		list-style: none;
		margin: 0px;

		li {
			list-style-image: none;
			margin: 10px;
			border: 1px solid #ccc;
			padding: 4px;
			border-radius: 4px;
			color: #666;
			cursor: move;

			/* &:hover {
			background-color: #eee;
		} */
		}
	}
</style>
